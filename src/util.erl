%%%-------------------------------------------------------------------
%%% Created : 22 Oct 2020 by Thiago Esteves <calori@gmail.com>
%%%
%%% @doc
%%%
%%% @end
%%%-------------------------------------------------------------------

-module(util).

-author('Thiago Esteves').

%%%===================================================================
%%% Includes
%%%===================================================================

%%%===================================================================
%%% Function exports
%%%===================================================================

%% gen_server exports
-export([md5sum/1, maybe_json_decode/1]).

%%%===================================================================
%%% Global Defines
%%%===================================================================

%%%===================================================================
%%% API
%%%===================================================================

%%--------------------------------------------------------------------
%% @doc Calculate the hex md5 of a string
%%
%% @param String String to be calculated
%% @end
%%--------------------------------------------------------------------
-spec md5sum(jsone:json_value() | string()) -> string().
md5sum(String) ->
    X = erlang:md5(String),
    [begin if N < 10 -> 48 + N; true -> 87 + N end end || <<N:4>> <= X].

%%--------------------------------------------------------------------
%% @doc Try to decode json string
%%
%% @param String String to be decoded
%% @end
%%--------------------------------------------------------------------
-spec maybe_json_decode(string()) -> {ok | error, map() | json}.
maybe_json_decode(Str) ->
  try jsone:decode(erlang:list_to_binary(Str)) of
    DecodedStr -> {ok, DecodedStr}
  catch
    _:_ ->
        {error, json}
  end.

